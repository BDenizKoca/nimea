<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nimea EtkileÅŸimli Harita</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@400;500;700&family=EB+Garamond:wght@400;500;700&display=swap&subset=latin-ext">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="https://unpkg.com/@geoman-io/leaflet-geoman-free@latest/dist/leaflet-geoman.css" />
    <link rel="stylesheet" href="style.css">
    <link rel="manifest" href="/manifest.webmanifest">
    <link rel="icon" href="/myicon.png">
    <link rel="apple-touch-icon" href="/myicon.png">
    <meta name="theme-color" content="#8b4513">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="mobile-web-app-capable" content="yes">
</head>
<body>
    <header class="map-header">
        <nav class="map-nav">
            <a href="../" class="nav-link">Ana Sayfa</a>
            <a href="../wiki/" class="nav-link">KÃ¼lliyat</a>
            <h1 class="map-title">Nimea EtkileÅŸimli Harita</h1>
            <div class="lang-switch">
                <a href="../en/map/">EN</a>
            </div>
            <button id="pwa-install" class="wiki-link">UygulamayÄ± YÃ¼kle</button>
        </nav>
    </header>
    
    <div id="map"></div>

    <!-- Route sidebar reopen button -->
    <button id="reopen-route-sidebar" class="reopen-route-btn hidden" title="Rota PlanlayÄ±cÄ±sÄ±nÄ± AÃ§">ğŸ—ºï¸</button>

    <div class="map-legend hidden" id="map-legend" role="region" aria-label="Harita AÃ§Ä±klamalarÄ±">
        <h4>AÃ§Ä±klamalar</h4>
        <ul>
            <li><span class="legend-swatch legend-road"></span> Yol</li>
            <li><span class="legend-swatch legend-difficult"></span> Zorlu Arazi</li>
            <li><span class="legend-swatch legend-unpassable"></span> GeÃ§ilmez Arazi</li>
            <li><span class="legend-swatch legend-route"></span> Rota</li>
        </ul>
    <div class="legend-note">Ã–lÃ§ek: 115 px = 50 km</div>
    </div>

    <!-- Overlay segmented control will appear through existing container -->

    <div class="sidebar left-sidebar" id="route-sidebar">
        <button id="close-route-sidebar" class="sidebar-close-btn">&times;</button>
    <h2>Rota PlanlayÄ±cÄ±</h2>
        <div id="route-stops"></div>
        <div id="route-summary"></div>
    </div>

    <div class="sidebar right-sidebar" id="info-sidebar">
        <button id="close-info-sidebar" aria-label="Kapat">&times;</button>
        <div id="info-content"></div>
    </div>

    <!-- DM Mode Marker Creation Form -->
    <div class="modal hidden" id="marker-creation-modal">
        <div class="modal-content">
            <h3>Yeni Ä°ÅŸaret OluÅŸtur</h3>
            <form id="marker-form">
                <input type="hidden" id="marker-lat">
                <input type="hidden" id="marker-lng">
                <div class="form-group">
                    <label for="marker-name-tr">Ad (TR) *</label>
                    <input type="text" id="marker-name-tr" name="marker-name-tr" required>
                </div>
                <div class="form-group">
                    <label for="marker-name-en">Name (EN)</label>
                    <input type="text" id="marker-name-en" name="marker-name-en">
                </div>
                
                <div class="form-group">
                    <label for="marker-id">Kimlik (ID) *</label>
                    <input type="text" id="marker-id" name="marker-id" required>
                    <small>Ä°simden otomatik Ã¼retilir; dÃ¼zenleyebilirsin</small>
                </div>
                
                <div class="form-group">
                    <label for="marker-type">TÃ¼r</label>
                    <select id="marker-type" name="marker-type">
                        <option value="city">Åehir</option>
                        <option value="town">Kasaba</option>
                        <option value="village">KÃ¶y</option>
                        <option value="fortress">Hisar</option>
                        <option value="ruin">Harabe</option>
                        <option value="landmark">AnÄ±t</option>
                        <option value="dungeon">Zindan</option>
                        <option value="other">DiÄŸer</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="marker-icon">Ã–zel Simge</label>
                    <div class="icon-input-container">
                        <input type="text" id="marker-icon" name="marker-icon" placeholder="VarsayÄ±lan iÃ§in boÅŸ bÄ±rak" maxlength="10">
                        <!-- Emoji Ã¶nerileri kaldÄ±rÄ±ldÄ± -->
                    </div>
                    <small>Ä°stersen Ã¶zel bir simge karakteri yazabilirsin</small>
                </div>
                
                <div class="form-group">
                    <label for="marker-icon-url">Veya Ã–zel GÃ¶rsel URL</label>
                    <input type="url" id="marker-icon-url" name="marker-icon-url" placeholder="https://example.com/icon.png">
                    <small>PNG/JPG bir simge URLâ€™si kullanabilirsin (yukarÄ±daki deÄŸerin yerine geÃ§er)</small>
                </div>
                
                <div class="form-group">
                    <label for="marker-faction-tr">Cemiyet/Devlet (TR)</label>
                    <input type="text" id="marker-faction-tr" name="marker-faction-tr" placeholder="Aurelius Ä°mparatorluÄŸu">
                </div>
                <div class="form-group">
                    <label for="marker-faction-en">Faction (EN)</label>
                    <input type="text" id="marker-faction-en" name="marker-faction-en" placeholder="Empire of Aurelius">
                </div>

                <div class="form-group">
                    <label for="marker-summary-tr">Ã–zet (TR) *</label>
                    <textarea id="marker-summary-tr" name="marker-summary-tr" rows="3" required></textarea>
                </div>
                <div class="form-group">
                    <label for="marker-summary-en">Summary (EN)</label>
                    <textarea id="marker-summary-en" name="marker-summary-en" rows="3"></textarea>
                </div>

                <div class="form-group">
                    <label for="marker-wiki-slug">Wiki KÄ±sa Ad (Slug)</label>
                    <input type="text" id="marker-wiki-slug" name="marker-wiki-slug" placeholder="Optional: e.g., empire-of-aurelius">
                    <small>Verilirse doÄŸrudan /wiki/&lt;slug&gt;/ adresine baÄŸlanÄ±r; aksi hÃ¢lde otomatik Ã¼retilir.</small>
                </div>
                
                <div class="form-group">
                    <label for="marker-coordinates">Koordinatlar</label>
                    <input type="text" id="marker-coordinates" readonly>
                </div>
                
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="marker-public" name="marker-public" checked>
                        Herkese aÃ§Ä±k (oyuncular gÃ¶rebilir)
                    </label>
                </div>
                
                <div class="form-actions">
                    <button type="button" id="cancel-marker">VazgeÃ§</button>
                    <button type="submit" id="save-marker">Ä°ÅŸareti OluÅŸtur</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Bulk Import Modal for DM Mode -->
    <div class="modal hidden" id="bulk-import-modal">
        <div class="modal-content">
            <h3>Toplu Ä°ÅŸaret Ä°Ã§e Aktarma</h3>
            <div class="form-group">
                <label for="csv-input">CSV Verisi</label>
                <textarea id="csv-input" rows="10" placeholder="name,x,y,type,faction,summary,public
Varkas,1234,987,city,Kuruntar,Eski baÅŸkent,true
Thornhold,2000,1500,fortress,Empire,DaÄŸ kalesi,true"></textarea>
                <small>BiÃ§im: name,x,y,type,faction,summary,public (baÅŸlÄ±k satÄ±rÄ± isteÄŸe baÄŸlÄ±)</small>
            </div>
            
            <div class="form-group">
                <label for="csv-file">Ya da CSV dosyasÄ± yÃ¼kle:</label>
                <input type="file" id="csv-file" accept=".csv" />
            </div>
            
            <div class="form-actions">
                <button type="button" id="cancel-import">VazgeÃ§</button>
                <button type="button" id="process-import">Ä°ÅŸaretleri Ä°Ã§e Aktar</button>
            </div>
        </div>
    </div>

    <!-- Terrain Type Selection Modal -->
    <div class="modal hidden" id="terrain-type-modal">
        <div class="modal-content">
            <h3>Arazi TÃ¼rÃ¼ SeÃ§</h3>
            <div class="terrain-options">
                <button type="button" class="terrain-btn road-btn" data-type="road">Yol<br>
                    <small>Daha hÄ±zlÄ±</small></button>
                <button type="button" class="terrain-btn difficult-btn" data-type="difficult">Zorlu<br>
                    <small>Daha yavaÅŸ</small></button>
                <button type="button" class="terrain-btn forest-btn" data-type="forest">Orman<br>
                    <small>Orta zorluk</small></button>
                <button type="button" class="terrain-btn unpassable-btn" data-type="unpassable">GeÃ§ilmez<br>
                    <small>Ä°mkÃ¢nsÄ±z</small></button>
            </div>
            <div class="form-actions">
                <button type="button" id="cancel-terrain">VazgeÃ§</button>
            </div>
        </div>
    </div>

    <div class="leaflet-top leaflet-right">
        <div class="leaflet-control-layers leaflet-control" id="overlay-toggles">
            <div class="overlay-segmented" role="group" aria-label="Kaplama gÃ¶rÃ¼nÃ¼rlÃ¼ÄŸÃ¼">
                <button type="button" data-mode="both" class="active" aria-pressed="true"><span>Ä°kisi</span></button>
                <button type="button" data-mode="regions" aria-pressed="false"><span>BÃ¶lgeler</span></button>
                <button type="button" data-mode="borders" aria-pressed="false"><span>SÄ±nÄ±rlar</span></button>
                <button type="button" data-mode="none" aria-pressed="false"><span>KapalÄ±</span></button>
            </div>
        </div>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://unpkg.com/@geoman-io/leaflet-geoman-free@latest/dist/leaflet-geoman.min.js"></script>
    <!-- Netlify Identity for DM authentication -->
    <script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>
    <script src="config.js"></script>
    <script src="git-client.js"></script>
    <script src="js/leaflet.tappable.js"></script>
    <!-- Routing Module Components (load before main routing.js) -->
    <script src="js/routing/terrain-utils.js"></script>
    <script src="js/routing/pathfinding.js"></script>
    <script src="js/routing/graph-builder.js"></script>
    <script src="js/routing/path-naturalizer.js"></script>
    <script src="js/routing/visualizer.js"></script>
    <!-- New Modular Routing Components -->
    <script src="js/routing/route-core.js"></script>
    <script src="js/routing/waypoint-manager.js"></script>
    <script src="js/routing/route-ui.js"></script>
    <script src="js/routing/route-drag-drop.js"></script>
    <script src="js/routing/route-share.js"></script>
    <script src="js/routing.js"></script>
    <!-- Internationalization -->
    <script src="js/i18n.js"></script>
    <!-- DM Module Components -->
    <script src="js/dm-controls.js"></script>
    <script src="js/dm-modals.js"></script>
    <script src="js/dm.js"></script>
    <!-- End DM Module Components -->
    <script src="js/ui.js"></script>
    <script src="js/direct-touch.js"></script>
    <script src="js/markers.js"></script>
    <script src="js/terrain.js"></script>
    <script src="map.js"></script>
        <script>
            // PWA install prompt handling (TR)
            let deferredPrompt;
            const installBtn = document.getElementById('pwa-install');
            window.addEventListener('beforeinstallprompt', (e) => {
                e.preventDefault();
                deferredPrompt = e;
                installBtn.style.display = 'inline-block';
            });
            installBtn?.addEventListener('click', async () => {
                if (!deferredPrompt) return;
                deferredPrompt.prompt();
                const { outcome } = await deferredPrompt.userChoice;
                if (outcome) {
                    installBtn.style.display = 'none';
                }
                deferredPrompt = null;
            });
            if ('serviceWorker' in navigator) {
                window.addEventListener('load', () => {
                    navigator.serviceWorker.register('/service-worker.js').catch(console.error);
                });
            }
        </script>
</body>
</html>
