<p>Of course. Here is a tidied, brief, and precise version of your plan, incorporating feedback and the new map size information.</p>
<hr>
<h3>**Nimea Interactive Map</h3>
<ul>
<li><strong>Summary:</strong> A zero-backend, single-page interactive world map for Nimea. Features include layered overlays, named locations, DM-editable terrain costs, and route planning in custom units.</li>
<li><strong>Tech Stack:</strong> Leaflet.js (CRS.Simple), Leaflet.Geoman, EasyStar.js, Turf.js, Vanilla JS/CSS.</li>
</ul>
<hr>
<h3><strong>1. Vision &amp; Core Principles ğŸ¯</strong></h3>
<p>Create a fast, elegant, full-screen map that provides reliable travel estimates based on DM-editable terrain rules.</p>
<ul>
<li><strong>Single Artifact:</strong> The app is built around a single map image (<code>map.png</code>).</li>
<li><strong>Fixed Scale:</strong> The scale is hardcoded to <strong>175 px = 100 km</strong> (~0.571 km/px).</li>
<li><strong>Layered Overlays:</strong> Transparent PNGs for regions and political borders can be toggled.</li>
<li><strong>DM-First Editing:</strong> A password-protected DM mode provides tools to edit all world data.</li>
<li><strong>Own Your Data:</strong> All map data is stored in version-controlled JSON/GeoJSON files.</li>
<li><strong>Zero Backend:</strong> The entire application is a static site, requiring no server-side processing.</li>
</ul>
<hr>
<h3><strong>2. Core Use Cases ğŸ—ºï¸</strong></h3>
<ul>
<li>
<p><strong>Player Flow:</strong></p>
<ol>
<li>Open the map and pan/zoom.</li>
<li>Toggle region/political overlays.</li>
<li>Click a location to open a right sidebar with lore and images.</li>
<li>Click &quot;Add to Route.&quot; A left sidebar appears showing the route.</li>
<li>Add more stops. The route updates with total distance (km) and travel time estimates for <strong>Walk (30 km/day)</strong>, <strong>Wagon (50 km/day)</strong>, and <strong>Horse (60 km/day)</strong>.</li>
</ol>
</li>
<li>
<p><strong>DM Flow (Desktop First):</strong></p>
<ol>
<li>Access DM mode via a URL parameter (<code>?dm=1</code>) and a simple passcode.</li>
<li>Use the DM toolbar to <strong>add or edit locations</strong>, including text and images.</li>
<li>Use paint tools to <strong>define terrain costs</strong> (Roads, Difficult Terrain, Blocked Areas).</li>
<li>Click &quot;Export&quot; buttons to download the updated <code>markers.json</code> and <code>terrain.geojson</code> files.</li>
<li>Commit the downloaded files to the project's git repository to persist the changes.</li>
</ol>
</li>
</ul>
<hr>
<h3><strong>3. Scope &amp; Roadmap ğŸ“‹</strong></h3>
<h4><strong>MVP (v0.1 - Must Haves)</strong></h4>
<ul>
<li><strong>MVP-1: Base Map:</strong> Full-screen Leaflet map that can be panned and zoomed.</li>
<li><strong>MVP-2: Overlays:</strong> Top-right toggles for <code>regions.png</code> and <code>borders.png</code>.</li>
<li><strong>MVP-3: Markers:</strong> Load markers from <code>markers.json</code> and display them on the map.</li>
<li><strong>MVP-4: Info Sidebar (Right):</strong> Clicking a marker opens a sidebar with its name, summary, and image gallery.</li>
<li><strong>MVP-5: Route Planner (Left):</strong> &quot;Add to Route&quot; button populates a multi-stop route planner.</li>
<li><strong>MVP-6: Pathfinding:</strong> A* routing calculates the shortest path respecting terrain costs.</li>
<li><strong>MVP-7: Travel Estimates:</strong> The route planner displays total distance (km) and travel time for all three profiles (Walk, Wagon, Horse).</li>
<li><strong>MVP-8: DM Mode:</strong> Gated by <code>?dm=1</code> and a passcode, revealing editing tools.</li>
<li><strong>MVP-9: DM Marker Editing:</strong> Tools to add, move, and edit location data.</li>
<li><strong>MVP-10: DM Terrain Painting:</strong> Geoman tools to draw polygons/lines for <code>road</code>, <code>difficult</code>, and <code>blocked</code> terrain.</li>
<li><strong>MVP-11: Data Export:</strong> &quot;Export&quot; buttons to save updated marker and terrain data as local files.</li>
<li><strong>MVP-12: Deployment:</strong> Deployed to a public static hosting provider (e.g., GitHub Pages).</li>
</ul>
<h4><strong>Post-MVP (v0.2+)</strong></h4>
<ul>
<li><strong>P-1: Route Management:</strong> Reorder route stops via drag-and-drop; remove individual stops.</li>
<li><strong>P-2: Marker Filtering:</strong> Search box and filters for marker name, type, or faction.</li>
<li><strong>P-3: Advanced Terrain:</strong> Add support for bridges and ferries as low-cost corridors over blocked areas.</li>
<li><strong>P-4: UI Polish:</strong> A simple legend, custom Nimea-themed map icons, and general visual improvements.</li>
</ul>
<hr>
<h3><strong>4. Key Challenge: Performance âš¡</strong></h3>
<p><strong>Pathfinding Grid Calculation:</strong> Generating the pathfinding cost grid on-the-fly for a ~25 million pixel map will be too slow in the browser.
* <strong>Solution:</strong> <strong>Pre-compute the grid.</strong> Create a separate Node.js script that reads the map dimensions and <code>terrain.geojson</code> and outputs a pre-calculated <code>cost_grid.json</code>. The web app will simply download this file on startup, ensuring a fast and responsive user experience.</p>
<hr>
<h3><strong>5. Data &amp; File Structure ğŸ“‚</strong></h3>
<p>All data is persisted by committing exported files to the git repository.</p>
<pre><code>/nimea-interactive-map
â”œâ”€â”€ index.html
â”œâ”€â”€ map.png          # Optimized map image
â”œâ”€â”€ /data
â”‚   â”œâ”€â”€ config.json
â”‚   â”œâ”€â”€ markers.json
â”‚   â”œâ”€â”€ terrain.geojson
â”‚   â””â”€â”€ cost_grid.json # Pre-computed pathfinding grid
â”œâ”€â”€ /overlays
â”‚   â”œâ”€â”€ regions.png
â”‚   â””â”€â”€ borders.png
â””â”€â”€ /images
    â””â”€â”€ ... (location images)
</code></pre>
<ul>
<li><strong><code>markers.json</code>:</strong> An array of marker objects with properties like <code>id</code>, <code>name</code>, <code>x</code>, <code>y</code>, <code>summary</code>, <code>images</code>, etc.</li>
<li><strong><code>terrain.geojson</code>:</strong> A FeatureCollection of Polygons and LineStrings. Each feature has a <code>properties: {&quot;kind&quot;: &quot;road&quot; | &quot;difficult&quot; | &quot;blocked&quot;}</code>.</li>
</ul>
